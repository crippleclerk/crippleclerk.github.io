<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CHAOS//OVERDRIVE â€” 3D + Head Nav (fixed)</title>
<meta name="theme-color" content="#ff00ff">
<style>
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:#05060a;color:#f6f8ff;overflow:hidden;font:16px/1.4 -apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Arial}
  canvas#gl{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;display:block;z-index:0}
  header{position:fixed;top:1rem;left:50%;transform:translateX(-50%);z-index:3;text-align:center;user-select:none}
  .mega{position:relative;display:inline-block;text-transform:uppercase;font-weight:900;font-size:clamp(28px,10vw,120px);letter-spacing:.06em;text-shadow:0 0 2px #fff,0 0 16px #0ff,0 0 32px #f0f}
  @keyframes jitter{0%,100%{transform:translate(0,0)}20%{transform:translate(-1px,1px)}40%{transform:translate(2px,-1px)}60%{transform:translate(-2px,0)}80%{transform:translate(1px,2px)}}
  header.jit{animation:jitter .25s steps(2) infinite}
  .panel{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);
    display:grid;grid-template-columns:1fr 1fr 1fr;gap:.6rem 1rem;min-width:min(92vw,900px);
    padding:1rem;border-radius:14px;background:rgba(10,10,18,.65);border:1px solid #ffffff24;
    backdrop-filter:blur(10px) saturate(1.1);z-index:4;box-shadow:0 10px 40px #000a}
  .panel h2{grid-column:1/-1;margin:0 0 .25rem 0;font-size:.95rem;letter-spacing:.08em;text-transform:uppercase;opacity:.9}
  label{display:flex;gap:.5rem;align-items:center;font-size:.9rem}
  input[type="range"]{width:100%}
  button{padding:.65rem .8rem;border-radius:10px;border:1px solid #ffffff26;background:#0b0f18;color:#f6f8ff;font-weight:800;cursor:pointer;box-shadow:inset 0 1px 0 #fff2,0 3px 16px #0008}
  button:hover{filter:brightness(1.1)}
  .badge{font-size:.75rem;padding:.2rem .5rem;border-radius:999px;border:1px solid #ffffff26;background:#0008;margin-left:.4rem;opacity:.85}
  .nav{position:fixed;top:10vh;left:50%;transform:translateX(-50%);z-index:4;display:flex;gap:1rem}
  .tab{padding:.5rem .9rem;border:1px solid #ffffff26;border-radius:999px;background:rgba(0,0,0,.35);backdrop-filter:blur(6px);font-weight:800;letter-spacing:.04em;opacity:.7}
  .tab.active{opacity:1;box-shadow:0 0 0 2px #fff2, 0 4px 20px #000a}
  .view{position:fixed;top:0;left:0;right:0;bottom:0;display:grid;place-items:center;z-index:2;pointer-events:none}
  .card{min-width:min(86vw,900px);max-width:min(92vw,1000px);padding:1.2rem 1.4rem;border:1px solid #ffffff26;border-radius:16px;background:linear-gradient(180deg,#0d1030cc,#080a18cc);box-shadow:0 30px 90px #000a,inset 0 0 40px #fff1}
  .card h1{margin:.2rem 0 .6rem 0;font-size:2rem;letter-spacing:.04em}
  .hint{opacity:.75;font-size:.9rem}
  .hud{position:fixed;top:.8rem;right:.8rem;z-index:5;display:flex;gap:.5rem;align-items:center;background:#0a0f18b3;border:1px solid #ffffff26;padding:.4rem .6rem;border-radius:10px}
  .dot{width:10px;height:10px;border-radius:50%}
  .dot.on{background:#2dd17a}.dot.off{background:#b00}
  .gesture{font-size:.8rem;opacity:.8}
  .err{position:fixed;left:.6rem;bottom:.6rem;background:#180a0ab3;border:1px solid #ff5a5a55;padding:.4rem .6rem;border-radius:8px;z-index:6;font-size:.8rem}
</style>
</head>
<body>
  <canvas id="gl" aria-hidden="true"></canvas>
  <header id="hdr"><div class="mega" id="title">CHAOS//OVERDRIVE</div></header>
  <div class="nav" id="nav"></div>
  <div class="view"><div class="card" id="content">
    <h1 id="sectionTitle">Welcome</h1>
    <div id="sectionBody" class="hint">Enable camera, then move head left/right to switch sections. Nod down to open, nod up to go back. Note: camera needs HTTPS or localhost in most browsers.</div>
  </div></div>
  <div class="hud">
    <div class="dot off" id="camdot"></div>
    <div id="camstatus">Camera: off</div>
    <div class="gesture" id="gstate"></div>
  </div>
  <div class="err" id="err" style="display:none"></div>
  <div class="panel" role="group" aria-label="Chaos Console">
    <h2>Chaos Console <span class="badge" id="fps">...fps</span></h2>
    <label>Kaleido <input type="range" id="k" min="1" max="16" step="1" value="10"></label>
    <label>Intensity <input type="range" id="int" min="0" max="1" step="0.01" value="0.95"></label>
    <button id="glitch">Title Jitter</button>
    <button id="cam">Enable Camera</button>
    <button id="cal">Calibrate</button>
  </div>

<script>
(function(){
  "use strict";
  function showErr(msg){var e=document.getElementById('err'); e.style.display='block'; e.textContent=msg; console.error(msg);}
  function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

  var sections=[
    {title:"Welcome", body:"Enable camera. Move head left/right to switch. Nod down to open, nod up to go back."},
    {title:"About", body:"Raymarched tunnel with torus, sphere, and box. Rotating 3D text is layered for faux depth."},
    {title:"Gallery", body:"Swap this with your imagery or live inputs. Shader parameters are adjustable below."},
    {title:"Contact", body:"Replace with your links. Head nav can trigger routes or actions."}
  ];
  var activeIndex=0, opened=false;
  var navEl=document.getElementById("nav");
  function renderTabs(){
    navEl.innerHTML="";
    for(var i=0;i<sections.length;i++){
      var b=document.createElement("div");
      b.className="tab"+(i===activeIndex?" active":"");
      b.textContent=sections[i].title;
      navEl.appendChild(b);
    }
  }
  function setContent(i){
    var t=document.getElementById("sectionTitle");
    var b=document.getElementById("sectionBody");
    t.textContent=sections[i].title;
    b.textContent=sections[i].body;
  }
  renderTabs(); setContent(activeIndex);

  window.addEventListener("keydown",function(e){
    if(e.key==="ArrowRight"){moveSection(1);}
    if(e.key==="ArrowLeft"){moveSection(-1);}
    if(e.key==="ArrowDown"){activate();}
    if(e.key==="ArrowUp"){back();}
  });
  function moveSection(dir){
    if(opened) return;
    activeIndex=(activeIndex+dir+sections.length)%sections.length;
    renderTabs(); setContent(activeIndex);
  }
  function activate(){
    if(opened) return;
    opened=true;
    document.getElementById("sectionBody").textContent="["+sections[activeIndex].title+"] opened. Nod up to go back.";
  }
  function back(){
    if(!opened) return;
    opened=false;
    setContent(activeIndex);
  }

  var glCanvas=document.getElementById("gl");
  var gl=null;
  try{
    gl=glCanvas.getContext("webgl",{antialias:false,depth:false,preserveDrawingBuffer:false});
  }catch(e){ showErr("WebGL context failed: "+e); return; }
  if(!gl){ showErr("WebGL not supported in this browser."); return; }
  function resizeGL(){
    var dpr=Math.min(window.devicePixelRatio||1,2);
    var w=Math.floor(innerWidth*dpr), h=Math.floor(innerHeight*dpr);
    glCanvas.width=w; glCanvas.height=h; glCanvas.style.width="100vw"; glCanvas.style.height="100vh";
    gl.viewport(0,0,w,h);
  }
  window.addEventListener("resize",resizeGL); resizeGL();

  var quad=new Float32Array([-1,-1, 1,-1, -1,1, 1,-1, 1,1, -1,1]);
  var quadBuf=gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER,quadBuf); gl.bufferData(gl.ARRAY_BUFFER,quad,gl.STATIC_DRAW);

  var vsBg="attribute vec2 a; varying vec2 v; void main(){ v=(a+1.0)*0.5; gl_Position=vec4(a,0.0,1.0);}";
  var fsBg=
    "precision mediump float;"
    + "varying vec2 v; uniform vec2 r; uniform float t; uniform float inten; uniform float kseg;"
    + "mat2 rot(float a){float c=cos(a),s=sin(a);return mat2(c,-s,s,c);}"
    + "float sdSphere(vec3 p,float s){return length(p)-s;}"
    + "float sdTorus(vec3 p,vec2 t){vec2 q=vec2(length(p.xz)-t.x,p.y);return length(q)-t.y;}"
    + "float sdBox(vec3 p, vec3 b){ vec3 q=abs(p)-b; return length(max(q,0.0))+min(max(q.x,max(q.y,q.z)),0.0);}"
    + "float smin(float a,float b,float k){float h=clamp(0.5+0.5*(b-a)/k,0.0,1.0);return mix(b,a,h)-k*h*(1.0-h);}"
    + "float mapObj(vec3 p, out int oid){"
    + "  float tt=t*0.5; vec3 q=p; q.xz*=rot(tt*0.7); q.yz*=rot(tt*0.9);"
    + "  float d1=sdTorus(q, vec2(1.0,0.28));"
    + "  vec3 s=p; s*=rot(tt*0.6); s+=vec3(1.5,0.6,1.2); float d2=sdSphere(s,0.8);"
    + "  vec3 b=p; b.xz*=rot(tt*1.1); b-=vec3(-1.8,0.2,-1.2); float d3=sdBox(b, vec3(0.7));"
    + "  float m=min(min(d1,d2),d3); oid=1; if(d2<m){oid=2; m=d2;} if(d3<m){oid=3; m=d3;}"
    + "  float ms=smin(smin(d1,d2,0.6),d3,0.6);"
    + "  return ms;"
    + "}"
    + "vec3 calcNormal(vec3 p){int dummy; vec2 e=vec2(0.001,0.0);"
    + " return normalize(vec3("
    + "  mapObj(p+vec3(e.x,0.0,0.0),dummy)-mapObj(p-vec3(e.x,0.0,0.0),dummy),"
    + "  mapObj(p+vec3(0.0,e.x,0.0),dummy)-mapObj(p-vec3(0.0,e.x,0.0),dummy),"
    + "  mapObj(p+vec3(0.0,0.0,e.x),dummy)-mapObj(p-vec3(0.0,0.0,e.x),dummy)"
    + "  ));"
    + "}"
    + "float march(vec3 ro, vec3 rd, out vec3 pos, out int oid){"
    + "  float tmin=0.0, tmax=30.0, tcur=tmin;"
    + "  for(int i=0;i<90;i++){ vec3 p=ro+rd*tcur; int id; float d=mapObj(p,id);"
    + "    if(d<0.001){ pos=p; oid=id; return tcur; }"
    + "    tcur+=d*0.9; if(tcur>tmax) break; }"
    + "  pos=ro+rd*tmax; oid=-1; return tmax;"
    + "}"
    + "vec3 palette(float h){ return mix(vec3(0.0,1.0,1.0), vec3(1.0,0.0,1.0), h); }"
    + "void main(){"
    + "  vec2 uv=(v*2.0-1.0); uv.x*=r.x/r.y;"
    + "  float seg=max(1.0,kseg); float ang=atan(uv.y,uv.x); float s=6.28318/seg; ang=mod(ang,s); ang=abs(ang-s*0.5);"
    + "  float rad=length(uv); vec2 ku=vec2(cos(ang),sin(ang))*rad;"
    + "  vec3 ro=vec3(0.0,0.0,4.2); vec3 rd=normalize(vec3(ku.x,ku.y,-1.6));"
    + "  vec3 pos; int oid; float hit=march(ro,rd,pos,oid);"
    + "  vec3 col=vec3(0.02,0.03,0.06);"
    + "  if(oid!=-1){ vec3 n=calcNormal(pos); vec3 l=normalize(vec3(0.8,0.7,0.2));"
    + "    float diff=max(0.0,dot(n,l)); float hue=0.5+0.5*sin(t+float(oid)); vec3 base=palette(hue);"
    + "    col=mix(col, base*(0.25+0.75*diff)*(0.6+0.4*inten), 0.9);"
    + "    float vgn=1.0-smoothstep(0.6,1.0,length(uv)); col*=vgn; }"
    + "  gl_FragColor=vec4(col,1.0);"
    + "}";

  function sh(type,src){
    var s=gl.createShader(type);
    gl.shaderSource(s,src); gl.compileShader(s);
    if(!gl.getShaderParameter(s,gl.COMPILE_STATUS)){ console.error("Shader error:", gl.getShaderInfoLog(s)); }
    return s;
  }
  function prog(vs,fs){
    var p=gl.createProgram();
    var v=sh(gl.VERTEX_SHADER,vs), f=sh(gl.FRAGMENT_SHADER,fs);
    gl.attachShader(p,v); gl.attachShader(p,f); gl.linkProgram(p);
    if(!gl.getProgramParameter(p,gl.LINK_STATUS)){ console.error("Program link error:", gl.getProgramInfoLog(p)); }
    return p;
  }

  var bgProg=prog(vsBg,fsBg);
  var aBg=gl.getAttribLocation(bgProg,"a");
  var uBgR=gl.getUniformLocation(bgProg,"r");
  var uBgT=gl.getUniformLocation(bgProg,"t");
  var uBgI=gl.getUniformLocation(bgProg,"inten");
  var uBgK=gl.getUniformLocation(bgProg,"kseg");

  // Rotating 3D text
  var textCanvas=document.createElement("canvas");
  var tw=1024, th=256; textCanvas.width=tw; textCanvas.height=th;
  var tctx=textCanvas.getContext("2d");
  function drawText(){
    tctx.clearRect(0,0,tw,th);
    tctx.fillStyle="#000"; tctx.fillRect(0,0,tw,th);
    tctx.font="900 140px Arial, Helvetica, sans-serif";
    tctx.textAlign="center"; tctx.textBaseline="middle";
    var grad=tctx.createLinearGradient(0,0,tw,0);
    grad.addColorStop(0,"#00ffff"); grad.addColorStop(1,"#ff00ff");
    tctx.fillStyle=grad; tctx.fillText("CHAOS//OVERDRIVE", tw/2, th/2);
  }
  drawText();
  var textTex=gl.createTexture();
  gl.bindTexture(gl.TEXTURE_2D,textTex);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);
  gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textCanvas);

  var vsTxt="attribute vec3 p; attribute vec2 uv; varying vec2 vuv; uniform mat4 mvp; void main(){ vuv=uv; gl_Position=mvp*vec4(p,1.0);}";
  var fsTxt="precision mediump float; varying vec2 vuv; uniform sampler2D tex; uniform float alpha; void main(){ vec4 c=texture2D(tex, vuv); if(c.a<0.1) discard; gl_FragColor=vec4(c.rgb, alpha);}";
  var txtProg=prog(vsTxt,fsTxt);
  var aTxtP=gl.getAttribLocation(txtProg,"p");
  var aTxtUV=gl.getAttribLocation(txtProg,"uv");
  var uTxtMVP=gl.getUniformLocation(txtProg,"mvp");
  var uTxtTex=gl.getUniformLocation(txtProg,"tex");
  var uTxtAlpha=gl.getUniformLocation(txtProg,"alpha");
  var textVerts=new Float32Array([
    -1,-0.25,0, 0,0,
     1,-0.25,0, 1,0,
    -1, 0.25,0, 0,1,
     1,-0.25,0, 1,0,
     1, 0.25,0, 1,1,
    -1, 0.25,0, 0,1
  ]);
  var txtBuf=gl.createBuffer(); gl.bindBuffer(gl.ARRAY_BUFFER,txtBuf); gl.bufferData(gl.ARRAY_BUFFER,textVerts,gl.STATIC_DRAW);

  function mul4(a,b){var o=new Float32Array(16),i=0,j=0; for(i=0;i<4;i++){for(j=0;j<4;j++){o[i*4+j]=a[i*4+0]*b[0*4+j]+a[i*4+1]*b[1*4+j]+a[i*4+2]*b[2*4+j]+a[i*4+3]*b[3*4+j];}} return o;}
  function rotY(a){var c=Math.cos(a),s=Math.sin(a); return new Float32Array([ c,0,-s,0, 0,1,0,0, s,0,c,0, 0,0,0,1 ]);}
  function rotX(a){var c=Math.cos(a),s=Math.sin(a); return new Float32Array([ 1,0,0,0, 0,c,-s,0, 0,s,c,0, 0,0,0,1 ]);}
  function trans(x,y,z){return new Float32Array([1,0,0,0, 0,1,0,0, 0,0,1,0, x,y,z,1]);}
  function scale(x,y,z){return new Float32Array([x,0,0,0, 0,y,0,0, 0,0,z,0, 0,0,0,1]);}
  function persp(fovy,aspect,near,far){var f=1/Math.tan(fovy/2), nf=1/(near-far); var m=new Float32Array(16); m[0]=f/aspect; m[5]=f; m[10]=(far+near)*nf; m[11]=-1; m[14]=(2*far*near)*nf; m[15]=0; return m;}

  // camera
  var camBtn=document.getElementById("cam");
  var calBtn=document.getElementById("cal");
  var camDot=document.getElementById("camdot");
  var camStatus=document.getElementById("camstatus");
  var gstate=document.getElementById("gstate");
  var video=null, vcan=null, vctx=null, prev=null, w=64, h=48;
  var lastCx=0, lastCy=0, cooldown=0, armedLR=true, armedUD=true;
  camBtn.onclick=function(){ enableCam(); };
  calBtn.onclick=function(){ prev=null; lastCx=0; lastCy=0; gstate.textContent="Calibrated"; };
  function enableCam(){
    if(video) return;
    if(!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)){
      showErr("getUserMedia requires HTTPS or localhost in most browsers."); return;
    }
    video=document.createElement("video"); video.autoplay=true; video.muted=true; video.playsInline=true;
    vcan=document.createElement("canvas"); vcan.width=w; vcan.height=h; vctx=vcan.getContext("2d");
    navigator.mediaDevices.getUserMedia({video:true,audio:false}).then(function(stream){
      video.srcObject=stream; camDot.className="dot on"; camStatus.textContent="Camera: on"; gstate.textContent="Move head to navigate";
    }).catch(function(err){ showErr("Camera permission denied: "+err.name); });
  }
  function processCamera(){
    if(!video || video.readyState<2) return;
    vctx.drawImage(video,0,0,w,h);
    var img=vctx.getImageData(0,0,w,h).data;
    var cx=0, cy=0, sum=0;
    if(prev==null){ prev=new Uint8ClampedArray(w*h); for(var i=0;i<w*h;i++) prev[i]=img[i*4]; return; }
    for(var y=0;y<h;y++){
      for(var x=0;x<w;x++){
        var idx=(y*w+x);
        var r=img[idx*4], g=img[idx*4+1], b=img[idx*4+2];
        var gray=((r+g+b)/3)|0;
        var d=Math.abs(gray - prev[idx]); prev[idx]=gray;
        if(d>18){ sum+=d; cx+=x*d; cy+=y*d; }
      }
    }
    if(sum>2000){
      cx/=sum; cy/=sum;
      var dx=(cx-lastCx)/w; var dy=(cy-lastCy)/h;
      lastCx=cx; lastCy=cy;
      interpretMotion(dx,dy);
    }else{
      if(cooldown>0) cooldown--; if(cooldown<=0){ armedLR=true; armedUD=true; }
      gstate.textContent="";
    }
  }
  function interpretMotion(dx,dy){
    if(Math.abs(dx)>0.12 && armedLR){
      if(dx>0){ moveSection(1); gstate.textContent="Right"; } else { moveSection(-1); gstate.textContent="Left"; }
      armedLR=false; cooldown=14;
    }
    if(Math.abs(dy)>0.12 && armedUD){
      if(dy>0){ activate(); gstate.textContent="Select"; } else { back(); gstate.textContent="Back"; }
      armedUD=false; cooldown=14;
    }
  }

  var header=document.getElementById("hdr");
  document.getElementById("glitch").onclick=function(){ header.classList.toggle("jit"); };
  var kEl=document.getElementById("k"), intEl=document.getElementById("int");
  var kseg=parseInt(kEl.value,10), intensity=parseFloat(intEl.value);
  kEl.oninput=function(e){kseg=parseInt(e.target.value,10)||10;};
  intEl.oninput=function(e){intensity=parseFloat(e.target.value)||0.95;};

  var fpsEl=document.getElementById("fps");
  var frames=0, last=performance.now();

  function drawBackground(time){
    gl.useProgram(bgProg);
    gl.bindBuffer(gl.ARRAY_BUFFER,quadBuf);
    gl.enableVertexAttribArray(aBg);
    gl.vertexAttribPointer(aBg,2,gl.FLOAT,false,0,0);
    gl.uniform2f(uBgR, glCanvas.width, glCanvas.height);
    gl.uniform1f(uBgT, time);
    gl.uniform1f(uBgI, intensity);
    gl.uniform1f(uBgK, kseg);
    gl.drawArrays(gl.TRIANGLES,0,6);
  }
  function drawText(time){
    gl.bindTexture(gl.TEXTURE_2D,textTex);
    gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,textCanvas);
    gl.enable(gl.BLEND);
    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
    gl.useProgram(txtProg);
    gl.bindBuffer(gl.ARRAY_BUFFER,txtBuf);
    gl.enableVertexAttribArray(aTxtP);
    gl.vertexAttribPointer(aTxtP,3,gl.FLOAT,false,20,0);
    gl.enableVertexAttribArray(aTxtUV);
    gl.vertexAttribPointer(aTxtUV,2,gl.FLOAT,false,20,12);
    var aspect=glCanvas.width/glCanvas.height;
    var P=persp(Math.PI/3, aspect, 0.1, 20.0);
    var RY=rotY(time*0.7);
    var RX=rotX(Math.sin(time*0.4)*0.2);
    var S=scale(1.9,0.9,1.0);
    var T=trans(0,0,-1.6);
    var M=mul4(mul4(mul4(S,RX),RY),T);
    var MVP=mul4(M,P);
    gl.uniform1i(uTxtTex,0);
    for(var i=6;i>=0;i--){
      var M2=new Float32Array(M); M2[14]+= -i*0.02;
      var MVP2=mul4(M2,P);
      gl.uniformMatrix4fv(uTxtMVP,false,MVP2);
      gl.uniform1f(uTxtAlpha, i===0? 1.0 : 0.12);
      gl.drawArrays(gl.TRIANGLES,0,6);
    }
    gl.disable(gl.BLEND);
  }
  function loop(){
    requestAnimationFrame(loop);
    var now=performance.now();
    frames++; if(now-last>=500){ fpsEl.textContent=Math.round(frames*1000/(now-last))+"fps"; frames=0; last=now; }
    processCamera();
    var tSec=now/1000;
    drawBackground(tSec);
    drawText(tSec);
  }
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
